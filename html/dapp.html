<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ETH Wallet</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <script src="../js/dapp.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/web3.min.js"></script>
</head>

<body>
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header layui-bg-gray">
            <div class="layui-logo  layui-bg-gray">Code</div>
            <!-- å¤´éƒ¨åŒºåŸŸï¼ˆå¯é…åˆlayui å·²æœ‰çš„æ°´å¹³å¯¼èˆªï¼‰ -->
            <ul class="layui-nav layui-layout-left ">
                <!-- ç§»åŠ¨ç«¯æ˜¾ç¤º -->
                <li class="layui-nav-item"><a href="assets.html">èµ„äº§</a></li>
                <li class="layui-nav-item"><a href="transaction.html">äº¤æ˜“</a></li>
                <li class="layui-nav-item"><a href="record.html">è®°å½•</a></li>
                <li class="layui-nav-item"><a href="setup.html">è®¾ç½®</a></li>
                <li class="layui-nav-item layui-this"><a href="dapp.html">åº”ç”¨</a></li>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item  layui-show-md-inline-block">
                    <form class="layui-form layui-form-pane" action="">
                        <div class="layui-form-item">
                            <label class="layui-form-label">è´¦æˆ·:</label>
                            <div class="layui-input-inline">
                                <select id="selectaccount" lay-filter="selectaccount">
                                    <!-- <option value="">è¯·é€‰æ‹©çœ</option> -->
                                    <!-- <option value="æµ™æ±Ÿ" selected="">æµ™æ±Ÿçœ</option>
                                <option value="ä½ çš„å·¥å·">æ±Ÿè¥¿çœ</option> -->
                                </select>
                            </div>
                        </div>
                    </form>
                    <!-- <a href="javascript:;">
                        <img src="https://ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/baike/pic/item/37d12f2eb9389b500dacecf68c35e5dde6116ec6.jpg"
                            class="layui-nav-img">
                        Account
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="">Your Profile</a></dd>
                        <dd><a href="">Settings</a></dd>
                        <dd><a href="">Sign out</a></dd>
                    </dl> -->
                </li>
                <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-more-vertical"></i>
                    </a>
                </li>
            </ul>
        </div>
        <div>
            <!-- å†…å®¹ä¸»ä½“åŒºåŸŸ -->
            <div style="padding: 100px;">
                <h1 class="layui-col-xs12">åº”ç”¨</h1>

                <h1 class="layui-col-xs12">&nbsp;</h1>
                <form class="layui-form layui-form-pane layui-col-xs5" action="" style="color: #4d6efb;">
                    <div class=" layui-inline ">
                        <label class=" layui-form-label"
                            style="background-color: #f5f5f5 ;border-color: #f5f5f5;">é€‰æ‹©ç½‘ç»œ</label>
                        <div class="layui-input-inline">
                            <select id="selectnet" lay-filter="selectnet">
                            </select>
                        </div>
                    </div>
                </form>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                    <legend>ğŸ’»</legend>
                </fieldset>
                <div class="layui-col-xs12">&nbsp;</div>
                <div class="layui-col-xs12">&nbsp;</div>
                <div class="layui-col-xs12">&nbsp;</div>
                <div class="layui-col-xs12">&nbsp;</div>
                <!-- <div style="padding: 100px;">
                
                <h1 class="layui-col-xs12">&nbsp;</h1>
                <form class="layui-form layui-form-pane layui-col-xs5" action="" style="color: #4d6efb;">
                    <div class=" layui-inline ">
                        <label class=" layui-form-label"
                            style="background-color: #f5f5f5 ;border-color: #f5f5f5;">é€‰æ‹©ç½‘ç»œ</label>
                        <div class="layui-input-inline">
                            <select id="selectnet" lay-filter="selectnet">
                            </select>
                        </div>
                    </div>
                </form>
            </div> -->
                <h1>åº”ç”¨ä¸€</h1>
                <div class="layui-col-xs12">&nbsp;</div>
                <!-- <input type="text" name="" id="message"><button id="sendmessage">sendmessage</button> -->
                <div class="layui-form-item layui-col-xs12">
                    <button class="layui-btn layui-btn-radius layui-btn-warm layui-col-xs2" id="getmessage"
                        style="font-weight:600;font-size:18px;">getmessage</button>
                    <div class="layui-col-md6">
                        <div class="layui-panel">
                            <div style="padding: 10px;">
                                <div>message is :</div>
                                <div id=state1></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-footer">
                    <!-- åº•éƒ¨å›ºå®šåŒºåŸŸ -->
                    <h3 id="address"></h3>
                </div>

            </div>
            <script src="./layui/layui.js"></script>
            <script type='text/javascript' src='http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js'></script>
            <script src="https://cdn.bootcss.com/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
            <script>
                //JS 
                layui.use(['element', 'layer', 'util', 'form'], function () {
                    var element = layui.element
                        , layer = layui.layer
                        , util = layui.util
                        , form = layui.form
                        , $ = layui.$;
                    //é¡¹ç›®è°ƒè¯•è·¯å¾„
                    let { ipcRenderer } = require('electron');
                    ipcRenderer.on("balance", (event, balance) => {
                        console.log(balance);
                        $(".balance").empty();
                        for (var i = 0; i < balance.value.length; i++) {
                            var p;
                            if (balance.value[i].symbol == "ETH") {
                                if (balance.value[i].balance == 0) {
                                    p = 1
                                } else {
                                    p = 1000000000000000000;
                                }
                                a = '<h1 class="layui-col-xs3">' + balance.value[i].symbol + '</h1><h1 class="layui-col-xs9">' + (balance.value[i].balance / p) + '</h1>';
                            } else {
                                a = '<h1 class="layui-col-xs3">' + balance.value[i].symbol + '</h1><h1 class="layui-col-xs9">' + (balance.value[i].balance / 1) + '</h1>';

                            }
                            /*$(".stage") æ˜¯jqueryé€‰æ‹©åˆ°ä¸€ä¸ªclassä¸ºstageçš„å…ƒç´ 
                             appendæ˜¯å°†æˆ‘ä»¬aæ·»åŠ åˆ°ä»–çš„å­èŠ‚ç‚¹ï¼ˆå­å…ƒç´ ï¼‰ä¸­ */
                            $(".balance").append(a);
                        }
                    })
                    const accountpath = '../Accountfile/json/account.json';
                    const netpath = '../Accountfile/json/net.json';
                    //æ‰“åŒ…è·¯å¾„
                    // const accountpath = '../../Accountfile/json/account.json';
                    // const netpath = '../../Accountfile/json/net.json';


                    //readNet();
                    //å¤´éƒ¨äº‹ä»¶
                    form.on('select(selectaccount)', function (data) {
                        // console.log(data.elem); //å¾—åˆ°selectåŸå§‹DOMå¯¹è±¡
                        $("#address").text("å½“å‰æ“ä½œè´¦æˆ·ä¸º ï¼š" + data.value);
                        var net = $('#selectnet').val();
                        dapp(net, data.value);
                        $('#qrcode').qrcode({
                            render: "canvas",//è®¾ç½®æ¸²æŸ“æ–¹å¼ ï¼ˆæœ‰ä¸¤ç§æ–¹å¼ tableå’Œcanvasï¼Œé»˜è®¤æ˜¯canvasï¼‰
                            width: 150,//å®½åº¦
                            height: 150,//é«˜åº¦
                            correctLevel: 0,//çº é”™ç­‰çº§
                            text: 'ethereum:' + data.value,
                            // background:"#00FF00",//èƒŒæ™¯è‰²
                            // foreground:"#FFFF00",//å‰æ™¯è‰²
                        });

                    });
                    form.on('select(selectnet)', function (data) {
                        // console.log(data.elem); //å¾—åˆ°selectåŸå§‹DOMå¯¹è±¡
                        var address = $('#selectaccount').val();
                        dapp(data.value, address);
                        // $('#qrcode').qrcode({
                        //     render:"canvas",//è®¾ç½®æ¸²æŸ“æ–¹å¼ ï¼ˆæœ‰ä¸¤ç§æ–¹å¼ tableå’Œcanvasï¼Œé»˜è®¤æ˜¯canvasï¼‰
                        //     width: 150,//å®½åº¦
                        //     height: 150,//é«˜åº¦
                        //     correctLevel:0,//çº é”™ç­‰çº§
                        //     text: 'ethereum:' + data.value,
                        //     // background:"#00FF00",//èƒŒæ™¯è‰²
                        //     // foreground:"#FFFF00",//å‰æ™¯è‰²
                        // });
                    });

                    $.ajax({
                        url: accountpath,
                        dataType: 'json',
                        type: 'get',
                        success: function (data) {
                            //ä¸‹é¢ä¼šæåˆ°è¿™ä¸ªdataæ˜¯ä»€ä¹ˆå€¼
                            //ä½¿ç”¨å¾ªç¯éå†ï¼Œç»™ä¸‹æ‹‰åˆ—è¡¨èµ‹å€¼
                            $.each(data.data, function (index, value) {
                                $('#selectaccount').append(new Option(value.id, value.address));// ä¸‹æ‹‰èœå•é‡Œæ·»åŠ å…ƒç´ 
                            });
                            var batch = $('#selectaccount').val();
                            $("#address").text("å½“å‰æ“ä½œè´¦æˆ·ä¸º ï¼š" + batch);
                            // (new Option(value.id, value.address));
                            layui.form.render("select");//é‡æ–°æ¸²æŸ“ å›ºå®šå†™æ³•
                        }
                    })


                    $.ajax({
                        url: netpath,
                        dataType: 'json',
                        type: 'get',
                        success: function (data) {
                            //ä¸‹é¢ä¼šæåˆ°è¿™ä¸ªdataæ˜¯ä»€ä¹ˆå€¼
                            //ä½¿ç”¨å¾ªç¯éå†ï¼Œç»™ä¸‹æ‹‰åˆ—è¡¨èµ‹å€¼
                            $.each(data.data, function (index, value) {
                                $('#selectnet').append(new Option(value.id, value.net));// ä¸‹æ‹‰èœå•é‡Œæ·»åŠ å…ƒç´ 
                            });
                            var batch = $('#selectnet').val();
                            // $("#address").text("å½“å‰æ“ä½œè´¦æˆ·ä¸º ï¼š" + batch);
                            // (new Option(value.id, value.address));
                            layui.form.render("select");//é‡æ–°æ¸²æŸ“ å›ºå®šå†™æ³•
                        }
                    })
                    util.event('lay-header-event', {
                        //å·¦ä¾§èœå•äº‹ä»¶
                        menuLeft: function (othis) {
                            layer.msg('å±•å¼€å·¦ä¾§èœå•çš„æ“ä½œ', { icon: 0 });
                        }
                        , menuRight: function () {
                            layer.open({
                                type: 1
                                , content: '<div style="padding: 15px;">å¤„ç†å³ä¾§é¢æ¿çš„æ“ä½œ</div>'
                                , area: ['260px', '100%']
                                , offset: 'rt' //å³ä¸Šè§’
                                , anim: 5
                                , shadeClose: true
                            });
                        }
                    });

                });

            </script>
</body>

</html>